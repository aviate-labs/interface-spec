type Satoshi = nat64;

type BlockHash = blob;

type OutPoint = record {
  txid : blob;
  vout : nat32
};

type Utxo = record {
  outpoint: OutPoint;
  value: Satoshi;
  height: nat32;
};

type Pagination = record {
  tip_block_hash : BlockHash;
  offset: opt nat32;
  limit: opt nat32;
};

type GetUtxosRequest = record {
  address : text;
  filter: opt variant {
    MinConfirmations: nat32;
    Pagination: Pagination;
  };
};

type GetUtxosError = variant {
  MalformedAddress;
};

type GetBalanceRequest = record {
  address : text;
  min_confirmations: opt nat32;
};

type GetBalanceError = variant {
  MalformedAddress;
};

type SendTransactionRequest = record {
  transaction: blob;
};

type SendTransactionError = variant {
  MalformedTransaction;
  NoFee;
  InvalidInputs;
};

service bitcoin : {

  get_balance: (GetBalanceRequest) -> (variant {
    Ok : Satoshi;
    Err: opt GetBalanceError;
  });

  get_utxos: (GetUtxosRequest) -> (variant {
    Ok : record {
      utxos: vec Utxo;
      total_count: nat32;
      tip_block_hash: BlockHash;
      tip_height: nat32;
    };
    Err : opt GetUtxosError;
  });

  send_transaction: (SendTransactionRequest) -> (variant {
    Ok;
    Err : opt SendTransactionError;
  });
}
